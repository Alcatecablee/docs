import { useState } from "react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Card } from "@/components/ui/card";
import { Loader2, FileText, ExternalLink, Download, Zap, Shield, CheckCircle2, Globe, Search, Layers, BookOpen, Palette, Settings, PlayCircle, ClipboardList, Rocket } from "lucide-react";
import { useToast } from "@/hooks/use-toast";
import { useMutation } from "@tanstack/react-query";
import { apiRequest, apiRequestBlob } from "@/lib/queryClient";
import Header from "@/components/Header";
import SignInDialog from "@/components/SignInDialog";
import { supabase } from "@/lib/supabaseClient";
import Footer from "@/components/Footer";
import { DocumentationViewer } from "@/components/DocumentationViewer";
import { ThemeSwitcher } from "@/components/ThemeSwitcher";
import { ThemeBuilder } from "@/components/ThemeBuilder";
import { BrandKitExtractor } from "@/components/BrandKitExtractor";
import { getDefaultTheme, Theme } from "../../shared/themes";
import { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from "@/components/ui/accordion";
import { TypewriterText } from "@/components/TypewriterText";

function convertToViewerTheme(theme: Theme) {
  return {
    // Colors
    primaryColor: theme.colors.primary,
    secondaryColor: theme.colors.secondary,
    accentColor: theme.colors.accent,
    backgroundColor: theme.colors.background,
    textColor: theme.colors.text,
    codeBgColor: theme.colors.code_bg,
    // Fonts
    fonts: [theme.typography.font_family, theme.typography.heading_font, theme.typography.code_font],
    primaryFont: theme.typography.font_family,
    // Structural tokens
    headingSizes: theme.typography.heading_sizes,
    spacing: {
      section: theme.spacing.section,
      paragraph: theme.spacing.paragraph,
      list_item: theme.spacing.list_item,
      density: theme.spacing.density,
    },
    styling: {
      border_radius: theme.styling.border_radius,
      code_border_radius: theme.styling.code_border_radius,
      shadow: theme.styling.shadow,
    },
    layout: {
      orientation: theme.layout.orientation,
    },
  } as const;
}

const Index = () => {
  const [url, setUrl] = useState("");
  const [subdomain, setSubdomain] = useState("");
  const [progress, setProgress] = useState(0);
  const [currentStage, setCurrentStage] = useState<number>(0);
  const [currentStageName, setCurrentStageName] = useState<string>("");
  const [currentStageDesc, setCurrentStageDesc] = useState<string>("");
  const [generatedDoc, setGeneratedDoc] = useState<any>(null);
  const [selectedTheme, setSelectedTheme] = useState<Theme>(getDefaultTheme());
  const { toast } = useToast();
  const [showSignIn, setShowSignIn] = useState(false);

  const stages = [
    { id: 1, name: "Site Discovery", description: "Multi-domain crawling and content mapping" },
    { id: 2, name: "Research & Analysis", description: "External research and community insights" },
    { id: 3, name: "Documentation Generation", description: "Professional content creation and structuring" },
    { id: 4, name: "Export & Optimization", description: "Multi-format export with theme application" }
  ];

  const generateMutation = useMutation({
    mutationFn: async ({ url, sessionId, subdomain }: { url: string; sessionId: string; subdomain?: string }) => {
      return apiRequest("/api/generate-docs", {
        method: "POST",
        body: JSON.stringify({ url, sessionId, subdomain }),
      });
    },
    onSuccess: (data) => {
      setProgress(100);
      setGeneratedDoc(data);
      toast({
        title: "Documentation Generated!",
        description: "Your professional documentation is ready",
      });
    },
    onError: (error: Error) => {
      console.error('Error generating documentation:', error);
      toast({
        title: "Generation Failed",
        description: error.message || "Failed to generate documentation. Please try again.",
        variant: "destructive",
      });
    },
  });

  const handleGenerate = async () => {
    // Check auth
    try {
      const { data } = await supabase.auth.getUser();
      if (!data?.user) {
        setShowSignIn(true);
        toast({ title: 'Sign in required', description: 'Please sign in to generate documentation' });
        return;
      }
    } catch (e) {
      console.warn('Auth check failed', e);
      setShowSignIn(true);
      return;
    }

    if (!url) {
      toast({
        title: "URL Required",
        description: "Please enter a valid website URL",
        variant: "destructive",
      });
      return;
    }

    setProgress(0);
    setCurrentStage(0);

    // Generate a unique session ID
    const sessionId = crypto.randomUUID();

    // Connect to SSE endpoint for real-time progress
    const eventSource = new EventSource(`/api/progress/${sessionId}`);

    eventSource.onmessage = (event) => {
      try {
        const progressData = JSON.parse(event.data);
        console.log('Progress update:', progressData);
        setCurrentStage(progressData.stage);
        setProgress(progressData.progress);
        setCurrentStageName(progressData.stageName || "");
        setCurrentStageDesc(progressData.description || "");
      } catch (e) {
        console.error('Failed to parse progress event:', e);
      }
    };

    eventSource.onerror = (error) => {
      console.error('SSE error:', error);
      eventSource.close();
    };

    try {
      await generateMutation.mutateAsync({ url, sessionId, subdomain: subdomain || undefined });
    } finally {
      eventSource.close();
    }
  };

  const downloadBlob = async (path: string, filename: string) => {
    try {
      // Ensure user is signed in and we have an access token
      try {
        const { data } = await supabase.auth.getSession();
        const token = data?.session?.access_token;
        if (!token) {
          setShowSignIn(true);
          toast({ title: 'Sign in required', description: 'Please sign in to download generated files' });
          return;
        }
      } catch (err) {
        console.warn('Failed to get supabase session before download', err);
        setShowSignIn(true);
        toast({ title: 'Sign in required', description: 'Please sign in to download generated files' });
        return;
      }

      const blob = await apiRequestBlob(path);
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    } catch (err: any) {
      console.error('Download failed', err);
      toast({ title: 'Download failed', description: err?.message || 'Failed to download file', variant: 'destructive' });
    }
  };

  const handleDownloadPDF = () => {
    if (!generatedDoc?.id) return;
    const filename = `${generatedDoc.title ? generatedDoc.title.replace(/[^a-z0-9]/gi, '_') : 'documentation'}.pdf`;
    downloadBlob(`/api/export/pdf/${generatedDoc.id}`, filename);
  };

  const handleDownloadDOCX = () => {
    if (!generatedDoc?.id) return;
    const filename = `${generatedDoc.title ? generatedDoc.title.replace(/[^a-z0-9]/gi, '_') : 'documentation'}.docx`;
    downloadBlob(`/api/export/docx/${generatedDoc.id}`, filename);
  };

  const handleDownloadMarkdown = () => {
    if (!generatedDoc?.id) return;
    const filename = `${generatedDoc.title ? generatedDoc.title.replace(/[^a-z0-9]/gi, '_') : 'documentation'}.md`;
    downloadBlob(`/api/export/markdown/${generatedDoc.id}`, filename);
  };

  const handleDownloadHTML = () => {
    if (!generatedDoc?.id) return;
    const filename = `${generatedDoc.title ? generatedDoc.title.replace(/[^a-z0-9]/gi, '_') : 'documentation'}.html`;
    downloadBlob(`/api/export/html/${generatedDoc.id}`, filename);
  };

  const handleDownloadJSON = () => {
    if (!generatedDoc?.id) return;
    const filename = `${generatedDoc.title ? generatedDoc.title.replace(/[^a-z0-9]/gi, '_') : 'documentation'}.json`;
    downloadBlob(`/api/export/json/${generatedDoc.id}`, filename);
  };

  const handleBatchExport = () => {
    if (!generatedDoc?.id) return;
    const filename = `${generatedDoc.title ? generatedDoc.title.replace(/[^a-z0-9]/gi, '_') : 'documentation'}_documentation.zip`;
    downloadBlob(`/api/export/batch/${generatedDoc.id}`, filename);
  };

  return (
    <div className="min-h-screen bg-background">
      <Header />
      <SignInDialog open={showSignIn} onOpenChange={setShowSignIn} />

      {/* Hero Section */}
      <main id="main-content">
      <section id="hero" className="relative overflow-hidden bg-gradient-to-br from-[rgb(36,77,91)] via-[rgb(40,85,100)] to-[rgb(36,77,91)]">
        {/* Background Elements */}
        <div className="absolute inset-0 bg-grid-white/[0.02] opacity-50" />
        <div className="absolute top-0 right-0 w-1/2 h-full bg-gradient-to-l from-white/5 to-transparent" />
        
        <div className="relative pt-24 pb-24 lg:pt-32 lg:pb-32">
          <div className="container mx-auto px-6 max-w-7xl">
            <div className="grid grid-cols-1 lg:grid-cols-12 gap-12 lg:gap-16 items-center">
              {/* Left Column - Text Content (7 columns) */}
              <div className="lg:col-span-7 text-left space-y-8">
                {/* Eyebrow */}
                <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/10 border border-white/20 backdrop-blur-sm">
                  <Zap className="h-4 w-4 text-white" />
                  <span className="text-sm font-medium text-white/90">AI-Powered Documentation</span>
                </div>
                
                {/* Headline - Primary Focus */}
                <h1 className="text-4xl md:text-5xl lg:text-6xl font-bold leading-[1.1] text-white tracking-tight">
                  Your documentation is already written.
                  <span className="block mt-2 text-white/80">It's just scattered across the internet.</span>
                </h1>
                
                {/* Description - Secondary */}
                <p className="text-lg lg:text-xl text-white/70 leading-relaxed max-w-xl">
                  We research how developers actually use your product across Stack Overflow, GitHub, and the web—then generate beautiful, Apple-quality docs that match your brand.
                </p>
                
                {/* CTA Form - Tertiary but Important */}
                <div className="pt-4">
                  <div className="flex flex-col sm:flex-row gap-3 p-2 rounded-2xl bg-white/10 border border-white/20 backdrop-blur-md shadow-2xl">
                    <Input
                      type="url"
                      placeholder="https://yourapp.com"
                      value={url}
                      onChange={(e) => setUrl(e.target.value)}
                      onKeyDown={(e) => e.key === 'Enter' && handleGenerate()}
                      className="flex-1 h-14 bg-white/10 border-0 text-white placeholder:text-white/50 text-base focus-visible:ring-2 focus-visible:ring-white/30"
                      disabled={generateMutation.isPending}
                    />
                    <Button 
                      size="lg" 
                      onClick={handleGenerate}
                      disabled={generateMutation.isPending || !url}
                      className="h-14 px-8 bg-white text-[rgb(36,77,91)] hover:bg-white/90 font-semibold shadow-xl hover:shadow-2xl transition-all whitespace-nowrap"
                    >
                      {generateMutation.isPending ? (
                        <>
                          <Loader2 className="mr-2 h-5 w-5 animate-spin" />
                          Generating...
                        </>
                      ) : (
                        <>
                          <FileText className="mr-2 h-5 w-5" />
                          Generate Docs
                        </>
                      )}
                    </Button>
                  </div>
                  <p className="mt-3 text-sm text-white/60 flex items-center gap-2">
                    <Shield className="h-4 w-4" />
                    Multi-stage pipeline with external research. Free to try.
                  </p>
                </div>

                {/* Trust Elements */}
                <div className="pt-4 flex items-center gap-6 flex-wrap">
                  <div className="flex items-center gap-2">
                    <CheckCircle2 className="h-5 w-5 text-emerald-400" />
                    <span className="text-sm text-white/70">No credit card required</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <CheckCircle2 className="h-5 w-5 text-emerald-400" />
                    <span className="text-sm text-white/70">5+ export formats</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <CheckCircle2 className="h-5 w-5 text-emerald-400" />
                    <span className="text-sm text-white/70">Custom branding</span>
                  </div>
                </div>
              </div>

              {/* Right Column - Visual Demo (5 columns) */}
              <div className="lg:col-span-5 relative">
                <div className="relative aspect-[4/3] w-full rounded-2xl border border-white/20 bg-gradient-to-br from-white/10 via-white/5 to-transparent backdrop-blur-xl overflow-hidden shadow-2xl">
                  {/* Decorative Elements */}
                  <div className="absolute inset-0 bg-gradient-to-t from-[rgb(36,77,91)]/50 to-transparent" />
                  <div className="absolute top-0 left-0 w-full h-px bg-gradient-to-r from-transparent via-white/40 to-transparent" />
                  
                  {/* Demo Content */}
                  <div className="relative flex items-center justify-center h-full p-8">
                    <div className="text-center">
                      <div className="w-24 h-24 mx-auto mb-6 rounded-2xl bg-white/10 backdrop-blur-sm flex items-center justify-center border border-white/20 shadow-xl hover:scale-105 transition-transform cursor-pointer">
                        <PlayCircle className="h-12 w-12 text-white" />
                      </div>
                      <p className="text-base font-medium text-white/90">Watch Demo</p>
                      <p className="text-sm text-white/60 mt-1">See it in action</p>
                    </div>
                  </div>
                </div>
                
                {/* Floating Stats */}
                <div className="absolute -bottom-6 -left-6 px-6 py-4 rounded-xl bg-white/10 backdrop-blur-md border border-white/20 shadow-xl hidden lg:block">
                  <div className="flex items-center gap-3">
                    <div className="p-2 rounded-lg bg-emerald-500/20">
                      <Rocket className="h-5 w-5 text-emerald-400" />
                    </div>
                    <div>
                      <p className="text-2xl font-bold text-white">500+</p>
                      <p className="text-xs text-white/70">Docs Generated</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      {/* Trusted By / Customers */}
      {!generatedDoc && (
        <section id="customers" className="relative overflow-hidden bg-gradient-to-b from-gray-50 to-white py-16">
          <div className="absolute inset-0 bg-grid-gray-900/[0.02] opacity-30" />
          <div className="relative container mx-auto px-6 max-w-7xl">
            <div className="text-center mb-12">
              <h3 className="text-sm font-semibold text-gray-500 uppercase tracking-wide mb-2">Trusted By Teams At</h3>
              <p className="text-lg text-gray-600">Leading companies use our platform to ship better docs faster</p>
            </div>
            <div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-8 lg:gap-12 items-center">
              {Array.from({ length: 6 }).map((_, i) => (
                <div key={i} className="flex items-center justify-center grayscale hover:grayscale-0 transition-all opacity-60 hover:opacity-100">
                  <img
                    src={`https://placehold.co/200x90/e5e7eb/6b7280?text=Logo+${i + 1}`}
                    alt={`Customer logo ${i + 1}`}
                    className="rounded w-full h-auto"
                    loading="lazy"
                  />
                </div>
              ))}
            </div>
          </div>
        </section>
      )}

      {/* Results Section */}
      {generatedDoc && (
        <section className="container mx-auto px-4 pb-20 animate-in fade-in slide-in-from-bottom-4 duration-1000">
          <div className="mb-8 glass-effect rounded-2xl p-6">
            <div className="flex items-center justify-between mb-6 flex-wrap gap-3">
              <h3 className="text-xl font-semibold">Export Documentation</h3>
              <div className="flex gap-2 flex-wrap">
                <BrandKitExtractor
                  onThemeGenerated={(theme) => {
                    setSelectedTheme(theme);
                  }}
                />
                <ThemeBuilder 
                  onThemeCreated={(theme) => {
                    setSelectedTheme(theme);
                  }}
                />
                <ThemeSwitcher
                  currentTheme={selectedTheme}
                  onThemeChange={setSelectedTheme}
                />
              </div>
            </div>
            <div className="flex flex-wrap gap-3 justify-center">
              <Button 
                variant="default" 
                size="lg" 
                className="gap-2 bg-primary hover:bg-primary/90 hover:shadow-glow rounded-xl hover:scale-[1.02] transition-all"
                onClick={handleBatchExport}
              >
                <Download className="h-5 w-5" />
                Download All (ZIP)
              </Button>
              <Button 
                variant="outline" 
                size="lg" 
                className="gap-2 border-white/10 bg-white/5 hover:bg-white/10 rounded-xl hover:scale-[1.02] transition-all"
                onClick={handleDownloadPDF}
              >
                <Download className="h-5 w-5" />
                PDF
              </Button>
              <Button 
                variant="outline" 
                size="lg" 
                className="gap-2 border-white/10 bg-white/5 hover:bg-white/10 rounded-xl hover:scale-[1.02] transition-all"
                onClick={handleDownloadDOCX}
              >
                <Download className="h-5 w-5" />
                DOCX
              </Button>
              <Button 
                variant="outline" 
                size="lg" 
                className="gap-2 border-white/10 bg-white/5 hover:bg-white/10 rounded-xl hover:scale-[1.02] transition-all"
                onClick={handleDownloadMarkdown}
              >
                <Download className="h-5 w-5" />
                Markdown
              </Button>
              <Button 
                variant="outline" 
                size="lg" 
                className="gap-2 border-white/10 bg-white/5 hover:bg-white/10 rounded-xl hover:scale-[1.02] transition-all"
                onClick={handleDownloadHTML}
              >
                <Download className="h-5 w-5" />
                HTML
              </Button>
              <Button 
                variant="outline" 
                size="lg" 
                className="gap-2 border-white/10 bg-white/5 hover:bg-white/10 rounded-xl hover:scale-[1.02] transition-all"
                onClick={handleDownloadJSON}
              >
                <Download className="h-5 w-5" />
                JSON
              </Button>
            </div>
          </div>

          <DocumentationViewer
            title={generatedDoc.title}
            description={generatedDoc.description}
            sections={generatedDoc.sections || []}
            theme={convertToViewerTheme(selectedTheme)}
          />
        </section>
      )}

      {/* WHY Section + Problems Accordion */}
      {!generatedDoc && (
        <section id="why" className="relative overflow-hidden bg-[rgb(142,209,198)] py-16 lg:py-20">
          {/* Subtle Background Pattern */}
          <div className="absolute inset-0 bg-grid-white/[0.03] opacity-40" />
          
          <div className="relative container mx-auto px-6 max-w-7xl">
            <div className="grid grid-cols-1 lg:grid-cols-12 gap-12 lg:gap-16 items-start">
              {/* Left Column - Content (7 columns) */}
              <div className="lg:col-span-7 space-y-6">
                <div className="space-y-4">
                  <h2 className="text-3xl md:text-4xl lg:text-5xl font-bold text-gray-900 leading-tight">
                    Traditional Docs Tools Only Scratch the Surface
                  </h2>
                  <p className="text-lg lg:text-xl text-gray-700 leading-relaxed">
                    Your website tells one part of the story. But the real knowledge—troubleshooting, common issues, best practices—lives in Stack Overflow threads, GitHub issues, and community discussions.
                  </p>
                </div>
                
                <div className="pt-4">
                  <h3 className="text-xl font-semibold text-gray-900 mb-6">Traditional tools fall short because they:</h3>
                  <Accordion type="single" collapsible className="w-full space-y-3">
                    <AccordionItem value="item-1" className="bg-white/40 backdrop-blur-sm border border-gray-900/10 rounded-xl px-6 data-[state=open]:shadow-lg transition-all">
                      <AccordionTrigger className="text-gray-900 hover:text-gray-900 font-medium py-4 hover:no-underline">
                        Only scrape your website—missing community knowledge
                      </AccordionTrigger>
                      <AccordionContent className="pb-4">
                        <ul className="space-y-2 text-gray-700">
                          <li className="flex items-start gap-2">
                            <span className="text-gray-900 mt-1">•</span>
                            <span>Ignore Stack Overflow solutions to common problems</span>
                          </li>
                          <li className="flex items-start gap-2">
                            <span className="text-gray-900 mt-1">•</span>
                            <span>Miss GitHub Issues where users report real bugs</span>
                          </li>
                          <li className="flex items-start gap-2">
                            <span className="text-gray-900 mt-1">•</span>
                            <span>Skip community forums with best practices</span>
                          </li>
                        </ul>
                      </AccordionContent>
                    </AccordionItem>
                    
                    <AccordionItem value="item-2" className="bg-white/40 backdrop-blur-sm border border-gray-900/10 rounded-xl px-6 data-[state=open]:shadow-lg transition-all">
                      <AccordionTrigger className="text-gray-900 hover:text-gray-900 font-medium py-4 hover:no-underline">
                        Generate incomplete troubleshooting sections
                      </AccordionTrigger>
                      <AccordionContent className="pb-4">
                        <ul className="space-y-2 text-gray-700">
                          <li className="flex items-start gap-2">
                            <span className="text-gray-900 mt-1">•</span>
                            <span>FAQs based on guesses, not real user questions</span>
                          </li>
                          <li className="flex items-start gap-2">
                            <span className="text-gray-900 mt-1">•</span>
                            <span>Missing edge cases and error messages</span>
                          </li>
                          <li className="flex items-start gap-2">
                            <span className="text-gray-900 mt-1">•</span>
                            <span>No validation of content quality or sources</span>
                          </li>
                        </ul>
                      </AccordionContent>
                    </AccordionItem>
                    
                    <AccordionItem value="item-3" className="bg-white/40 backdrop-blur-sm border border-gray-900/10 rounded-xl px-6 data-[state=open]:shadow-lg transition-all">
                      <AccordionTrigger className="text-gray-900 hover:text-gray-900 font-medium py-4 hover:no-underline">
                        Require manual styling and brand matching
                      </AccordionTrigger>
                      <AccordionContent className="pb-4">
                        <ul className="space-y-2 text-gray-700">
                          <li className="flex items-start gap-2">
                            <span className="text-gray-900 mt-1">•</span>
                            <span>Generic templates that don't match your brand</span>
                          </li>
                          <li className="flex items-start gap-2">
                            <span className="text-gray-900 mt-1">•</span>
                            <span>Manual color and font configuration</span>
                          </li>
                          <li className="flex items-start gap-2">
                            <span className="text-gray-900 mt-1">•</span>
                            <span>Inconsistent formatting across export formats</span>
                          </li>
                        </ul>
                      </AccordionContent>
                    </AccordionItem>
                    
                    <AccordionItem value="item-4" className="bg-white/40 backdrop-blur-sm border border-gray-900/10 rounded-xl px-6 data-[state=open]:shadow-lg transition-all">
                      <AccordionTrigger className="text-gray-900 hover:text-gray-900 font-medium py-4 hover:no-underline">
                        Lack transparency and reliability
                      </AccordionTrigger>
                      <AccordionContent className="pb-4">
                        <ul className="space-y-2 text-gray-700">
                          <li className="flex items-start gap-2">
                            <span className="text-gray-900 mt-1">•</span>
                            <span>No visibility into what sources were used</span>
                          </li>
                          <li className="flex items-start gap-2">
                            <span className="text-gray-900 mt-1">•</span>
                            <span>Single-point failures kill the entire pipeline</span>
                          </li>
                          <li className="flex items-start gap-2">
                            <span className="text-gray-900 mt-1">•</span>
                            <span>No quality scores or source attribution</span>
                          </li>
                        </ul>
                      </AccordionContent>
                    </AccordionItem>
                  </Accordion>
                </div>
              </div>
              
              {/* Right Column - Visual (5 columns) */}
              <div className="lg:col-span-5">
                <div className="relative aspect-[3/4] w-full rounded-2xl border border-gray-900/10 bg-white/30 backdrop-blur-sm overflow-hidden shadow-xl">
                  {/* Decorative gradient overlay */}
                  <div className="absolute inset-0 bg-gradient-to-br from-transparent to-gray-900/5" />
                  
                  <div className="relative flex items-center justify-center h-full p-6">
                    <img 
                      src="https://placehold.co/600x800?text=Docs+Screenshot" 
                      alt="Documentation screenshot showing multi-source research" 
                      className="rounded-lg border border-gray-900/10 shadow-lg w-full h-full object-cover" 
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      )}

      {/* Pipeline Section: mirrors actual pipeline (Discovery → Extraction → Research → Synthesis → Export) */}
      {!generatedDoc && (
        <section id="pipeline" className="container mx-auto px-4 py-20 border-t border-white/10">
          <div className="text-center max-w-3xl mx-auto mb-12">
            <h2 className="text-3xl md:text-4xl font-bold mb-4">Multi-Source Research Engine</h2>
            <p className="text-lg text-muted-foreground">We don't just scrape—we research. Stack Overflow + GitHub Issues + Real Google Results = Comprehensive Docs.</p>
          </div>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <div className="glass-effect rounded-2xl p-6">
              <div className="h-12 w-12 rounded-xl bg-primary/10 border border-primary/20 flex items-center justify-center mb-4">
                <Globe className="h-6 w-6 text-primary" />
              </div>
              <h4 className="font-semibold mb-2">Site Discovery</h4>
              <p className="text-sm text-muted-foreground">Multi‑domain crawling, sitemap parsing, subdomain probing, nav link extraction.</p>
            </div>
            <div className="glass-effect rounded-2xl p-6">
              <div className="h-12 w-12 rounded-xl bg-primary/10 border border-primary/20 flex items-center justify-center mb-4">
                <Search className="h-6 w-6 text-primary" />
              </div>
              <h4 className="font-semibold mb-2">Content Extraction</h4>
              <p className="text-sm text-muted-foreground">Multi‑page scraping with code blocks, images, headings, and content structure.</p>
            </div>
            <div className="glass-effect rounded-2xl p-6">
              <div className="h-12 w-12 rounded-xl bg-primary/10 border border-primary/20 flex items-center justify-center mb-4">
                <BookOpen className="h-6 w-6 text-primary" />
              </div>
              <h4 className="font-semibold mb-2">External Research</h4>
              <p className="text-sm text-muted-foreground">SerpAPI (real Google results) + Brave Search for redundancy. Pulls Stack Overflow solutions and GitHub Issues automatically.</p>
            </div>
            <div className="glass-effect rounded-2xl p-6">
              <div className="h-12 w-12 rounded-xl bg-primary/10 border border-primary/20 flex items-center justify-center mb-4">
                <Layers className="h-6 w-6 text-primary" />
              </div>
              <h4 className="font-semibold mb-2">Synthesis & Export</h4>
              <p className="text-sm text-muted-foreground">AI synthesis into 8+ sections and export to PDF, DOCX, HTML, Markdown, or hosted subdomain.</p>
            </div>
          </div>
        </section>
      )}

      {/* Features Section */}
      {!generatedDoc && (
        <section id="features" className="container mx-auto px-4 pb-24">
          <div className="max-w-6xl mx-auto">
            <div className="text-center mb-16">
              <h2 className="text-4xl md:text-5xl font-bold mb-6">Documentation Built on Real User Knowledge</h2>
              <p className="text-lg text-muted-foreground max-w-3xl mx-auto">
                Our multi-source research engine finds how developers actually use your product, then generates Stripe-quality docs with automatic brand matching
              </p>
            </div>
            
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-16">
              <div className="glass-effect rounded-2xl p-8 hover:scale-[1.02] transition-all duration-300 group">
                <div className="h-14 w-14 rounded-2xl bg-primary flex items-center justify-center mb-6 shadow-glow group-hover:shadow-glow transition-shadow">
                  <Globe className="h-7 w-7 text-primary-foreground" />
                </div>
                <h3 className="text-2xl font-semibold mb-3">Comprehensive Discovery</h3>
                <p className="text-muted-foreground leading-relaxed">Subdomain probing, sitemaps parsing, and nav link extraction for deep coverage.</p>
              </div>
              
              <div className="glass-effect rounded-2xl p-8 hover:scale-[1.02] transition-all duration-300 group">
                <div className="h-14 w-14 rounded-2xl bg-primary flex items-center justify-center mb-6 shadow-glow group-hover:shadow-glow transition-shadow">
                  <Search className="h-7 w-7 text-primary-foreground" />
                </div>
                <h3 className="text-2xl font-semibold mb-3">Multi-Source Research</h3>
                <p className="text-muted-foreground leading-relaxed">Goes beyond your site: SerpAPI (real Google results), Stack Overflow answers, GitHub Issues, and community forums—all with quality scoring.</p>
              </div>
              
              <div className="glass-effect rounded-2xl p-8 hover:scale-[1.02] transition-all duration-300 group">
                <div className="h-14 w-14 rounded-2xl bg-primary flex items-center justify-center mb-6 shadow-glow group-hover:shadow-glow transition-shadow">
                  <Shield className="h-7 w-7 text-primary-foreground" />
                </div>
                <h3 className="text-2xl font-semibold mb-3">Enterprise Quality</h3>
                <p className="text-muted-foreground leading-relaxed">Pipeline monitoring, quality scoring, retries/fallbacks, and accessibility-focused exports.</p>
              </div>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div className="glass-effect rounded-2xl p-8 hover:scale-[1.02] transition-all duration-300 group">
                <div className="h-14 w-14 rounded-2xl bg-primary flex items-center justify-center mb-6 shadow-glow group-hover:shadow-glow transition-shadow">
                  <Palette className="h-7 w-7 text-primary-foreground" />
                </div>
                <h3 className="text-2xl font-semibold mb-3">Automatic Apple/Stripe Styling</h3>
                <p className="text-muted-foreground leading-relaxed">Automatic brand color extraction from your CSS. Professional, polished formatting out of the box. No manual styling needed.</p>
              </div>
              
              <div className="glass-effect rounded-2xl p-8 hover:scale-[1.02] transition-all duration-300 group">
                <div className="h-14 w-14 rounded-2xl bg-primary flex items-center justify-center mb-6 shadow-glow group-hover:shadow-glow transition-shadow">
                  <Layers className="h-7 w-7 text-primary-foreground" />
                </div>
                <h3 className="text-2xl font-semibold mb-3">Multi-Format Export</h3>
                <p className="text-muted-foreground leading-relaxed">PDF, DOCX, HTML, Markdown, JSON, and hosted subdomain exports with theme metadata.</p>
              </div>
              
              <div className="glass-effect rounded-2xl p-8 hover:scale-[1.02] transition-all duration-300 group">
                <div className="h-14 w-14 rounded-2xl bg-primary flex items-center justify-center mb-6 shadow-glow group-hover:shadow-glow transition-shadow">
                  <Settings className="h-7 w-7 text-primary-foreground" />
                </div>
                <h3 className="text-2xl font-semibold mb-3">Production Ready</h3>
                <p className="text-muted-foreground leading-relaxed">Metadata & searchability, validation checks, subdomain routing, and pipeline status monitoring.</p>
              </div>
            </div>
          </div>
        </section>
      )}

      {/* Quality & Reliability section pulled from backend capabilities */}
      {!generatedDoc && (
        <section id="quality" className="container mx-auto px-4 pb-24">
          <div className="max-w-5xl mx-auto text-center">
            <h2 className="text-3xl md:text-4xl font-bold mb-6">Quality, Reliability, and Transparency</h2>
            <p className="text-muted-foreground mb-10">Real pipeline monitoring, multi-provider fallbacks, and research quality scoring give predictable outcomes.</p>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div className="glass-effect rounded-2xl p-6">
                <h4 className="font-semibold mb-2">Pipeline Monitoring</h4>
                <p className="text-sm text-muted-foreground">Stage-by-stage progress with recommendations and partial success handling.</p>
              </div>
              <div className="glass-effect rounded-2xl p-6">
                <h4 className="font-semibold mb-2">Fallbacks & Retries</h4>
                <p className="text-sm text-muted-foreground">Provider rotation (OpenAI/Groq/Local), exponential backoff, timeouts, and cache.</p>
              </div>
              <div className="glass-effect rounded-2xl p-6">
                <h4 className="font-semibold mb-2">Research Quality Score</h4>
                <p className="text-sm text-muted-foreground">Weighted by authority, freshness, and consensus across sources.</p>
              </div>
            </div>
          </div>
        </section>
      )}

      {/* Exports section highlighting routes */}
      {!generatedDoc && (
        <section id="exports" className="container mx-auto px-4 pb-24">
          <div className="max-w-5xl mx-auto text-center">
            <h2 className="text-3xl md:text-4xl font-bold mb-6">Exports that fit your workflow</h2>
            <p className="text-muted-foreground mb-10">Export to PDF, DOCX, HTML, Markdown, JSON, or host on a subdomain.</p>
            <div className="grid grid-cols-1 md:grid-cols-5 gap-6">
              {['PDF','DOCX','HTML','Markdown','JSON'].map((fmt) => (
                <div key={fmt} className="glass-effect rounded-2xl p-6">
                  <h4 className="font-semibold mb-2">{fmt}</h4>
                  <p className="text-sm text-muted-foreground">One click from the dashboard or via API.</p>
                </div>
              ))}
              <div className="glass-effect rounded-2xl p-6 md:col-span-5">
                <h4 className="font-semibold mb-2">Hosted Subdomain</h4>
                <p className="text-sm text-muted-foreground">Publish at <code>your-docs.example.com</code> with theme metadata baked in.</p>
              </div>
            </div>
          </div>
        </section>
      )}

      {/* Security/Privacy concise note */}
      {!generatedDoc && (
        <section id="security" className="container mx-auto px-4 pb-24">
          <div className="max-w-4xl mx-auto text-center">
            <h2 className="text-3xl md:text-4xl font-bold mb-4">Security & Privacy</h2>
            <p className="text-muted-foreground">Token-based API access, role-aware exports, and optional on-prem operation. No vendor lock-in—exports are portable.</p>
          </div>
        </section>
      )}
      {/* Bottom CTA */}
      {!generatedDoc && (
        <section className="container mx-auto px-4 pb-24">
          <div className="max-w-3xl mx-auto text-center glass-effect rounded-2xl p-10">
            <h3 className="text-2xl md:text-3xl font-bold mb-3">Ready to see DocSnap?</h3>
            <p className="text-muted-foreground mb-6">Book a quick demo to see how fast your team can publish great docs.</p>
            <div className="flex justify-center gap-3">
              <Button size="lg" className="bg-gradient-primary" onClick={() => setShowSignIn(true)}>Get a Demo</Button>
              <Button size="lg" variant="outline" asChild>
                <a href="#how">How it Works</a>
              </Button>
            </div>
          </div>
        </section>
      )}
      </main>
      
      <Footer />
    </div>
  );
};

export default Index;
